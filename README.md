# Тестовое задание #1

## Содержание

- [Исходное описание](#original)
- [Интерпретация задачи](#description)
- [Порядок разворачивания проекта](#deploy)
- [О написанном коде](#about-code)

## <a name="original"></a> Исходное описание

**ДАНО**: 2 файла с логами.

В 1-ом файле в каждой строке выводится 5 атрибутов разделенные символом «|»: дата, время, IP-адрес пользователя, URL с которого зашел, URL куда зашел.

Во 2-ом — в каждой строке 3 атрибута, также разделенные символом «|»: ip aдрес пользователя, наименование используемого браузера, наименование используемой ОС.

**ЗАДАНИЯ**:

1. Необходимо считать данные из этих файлов и записать в базу данных Postgresql.

2. Делать необязательно, но за выполнение дополнительный «плюс». Затем с помощью одного запроса к БД отдать данные для фронтенда, на основе которого будет заполнена таблица со следующими полями: IP-адрес, браузер, ос, URL с которого зашел первый раз, URL на который зашел последний раз, кол-во просмотренных уникальных URL-адресов. Должен быть предусмотрен постраничный просмотр.

**ВАЖНЫЕ ЗАМЕЧАНИЯ**:

Приложение сделать монолитом, фронтенд на PHP-шаблонах, на бэкенде PHP (можно использовать любой фреймворк, но желательно Zend Framework/Laminas или Symfony). Код должен быть в ООП-стиле. SQL-инъекций и прочих уязвимостей в коде быть не должно, на безопасность кода мы будем обращать самое пристальное внимание. Также просим уделить время стилю кода, комментариям - нужно сделать все красиво, не торопясь.

**РЕЗУЛЬТАТ ВЫПОЛНЕНИЯ ЗАДАНИЯ**:

Микроприложение, состоящее из следующих файлов и сценариев:

1) sql-файл для создания таблицы в БД (желательно использовать мигратор, если он есть в составе фреймворка)
2) два файла логов для тестирования
4) приложение

Приложение должно быть рабочим после создания таблицы в БД и запуска скрипта парсинга лог-файлов.

## <a name="description"></a> Интерпретация задачи

1) Так как нельзя очевидно связать записи из второго файла с первым, было решено сохранять логи в разные таблицы. Потом анализ этой информации будет зависеть от необходимых метрик.
2) Вывод на фронтенд в дополнительной задаче делать не стал, но есть возможность вывода таблицы в консоль дополнительной командой.

## <a name="deploy"></a> Порядок разворачивания проекта

* Склонировать проект
* Установить зависимости через Composer
* В `.env` файле в блоке с БД указать данные соединения, пример:
```
DB_CONNECTION=pgsql
DB_HOST=127.0.0.1
DB_PORT=5432
DB_DATABASE=laravel
DB_USERNAME=postgres
DB_PASSWORD=postgres
```
* В консоли из корня проекта выполнить команды:
```
php artisan config:cache
php artisan migrate
```
* Файлы логов хранятся в корне проекта и называются `log-1` (переходы), `log-2` (устройства)
* Запустите команду `php artisan app:parse-metrics-logs` для парсинга и сохранения данных в БД.
* Запустите команду `php artisan app:show-metrics` для вывода в консоли таблицы с метриками.
* Если понадобится протестировать приложение на другом наборе данных, то замените содержимое файлов логов и выполните набор команд:
```
php artisan migrate:fresh
php artisan app:parse-metrics-logs
php artisan app:show-metrics
```

## <a name="about-code"></a> О написанном коде

* Миграции:
```
database\migrations\2020_07_16_114124_create_transitions_table.php
database\migrations\2020_07_16_121048_create_ips_info_table.php
```
* Команды:
```
app\Console\Commands\ParseMetricsLogs.php
app\Console\Commands\ShowMetrics.php
```
* Классы для обработки логов:
```
app\Parser\BaseLogParser.php
app\Parser\TransitionsLogParser.php
app\Parser\IpsDevicesLogParser.php
```
